# Проект DonorSearch по определению ориентации медицинской справки на фотографии

## Введение
Заказчик - DonorSearch -  занимается развитием донорства в стране. Для этого есть платформа DonorSearch.org - где для доноров доступны бонусная программа, игрофикация пути донора и многое другое. Важной является проверка честности доноров и корректности внесенных донаций. Подтверждение производится по справке установленной формы (№405), такую справку донор получает в центре крови.

## Задачи проекта
- Исследовать существующие подходы к решению задачи;
- Выбор готовой или обучение собственной модели компьютерного зрения для определения ориентации изображения;
- Подготовка скриптов для препроцессинга изображения, инференса модели и постпроцессинга изображения;
- Тестирование модели, определение метрик;
- Создание микросервиса для последующей интеграции в продукт заказчика.


## Исходные данные
Набор изображений в разной ориентации. Имеются целевые фотографии справок, а так же дополнительные.


## Требования

- Рассчитана Accuracy для многоклассовой классификации;
- Построены ROC-кривые и матрицы ошибок для наилучшей из моделей;
- Формат входных данных - путь к изображению;
- Формат выходных данных - np.array или Pillow.Image (либи любой другой вариант, итоговый вариант озвучит заказчик);
- Количество классов классификатора - 4 (поворот на 0, 90, 180 или 270 градусов);
- Инференс - на CPU.

### **Инструкции по использованию:**
Для того, чтобы корректно работать с данным проектом, необходимо:
```
- выгрузить файлы config.py, init_model.py, main.py, requirements.txt

- создать виртуальное окружение, в которое необходимо уставить библиотеки, указанные в файле requirements.txt

- в файле config.py необходимо указать пути к тестовому видео и фото, количество фото которые хотим обработать,
  файлу предобученной модели yolov10x_v2_4_best.pt и к папке, в которую будут сохраняться результаты.

- после этого запускаем файл main.py
```

### Исходные данные

Фотографии медицинских справок - 173 единицы. 

### Метрика и условия:
- Скорость обработки кадра должна быть не более 100 мс. 
- Метрика оценки модели – Accuracy.

## Выбор модели

В проекте использовалось предобученные модели с последующим обучении на исходных данных с разной ориентацией (0, 90, 180, 270 градусов):
- ResNet18;
- ResNet34;
- EfficientNet_B0;
- MobileNet V3;
- ShuffleNet V2.

**Результат:**
- дообученная модель CV;
- микросервис написанный в FastAPI+uvicorn;
- docker image с микросервисом.

## Структура репозитория:

| #    | Наименование файла                | Описание   |
| ---- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 1.   | [README.md](https://github.com/FedorSafonov/tracking-objects-on-a-conveyor-belt/blob/main/README.md) | Представлена основная информация по проекту и его результатах   |
| 2.   | [config.py](https://github.com/FedorSafonov/tracking-objects-on-a-conveyor-belt/blob/main/config.py) | Класс, в котором задаются константы и пути к файлам   |
| 3.   | [init_model.py](https://github.com/FedorSafonov/tracking-objects-on-a-conveyor-belt/blob/main/init_model.py) | Класс, который инициализирует работу модели детекции и трекинга объектов и всех функций необходимых для визуализации их работы и расчета метрик   |
| 4.   | [main.py](https://github.com/FedorSafonov/tracking-objects-on-a-conveyor-belt/blob/main/main.py) | Код запуска всех методов имеющихся в классах    |
| 5.   | [requirements.txt](https://github.com/FedorSafonov/tracking-objects-on-a-conveyor-belt/blob/main/requirements.txt) | Список всех библиотек и их версии, необходимых для установки в виртуальной среде для запуска кода проекта   |
| 6.   | [streamlit_yolo.py](https://github.com/FedorSafonov/tracking-objects-on-a-conveyor-belt/blob/main/streamlit_yolo.py) | Веб приложение в стримлит с моделью заказчика YOLA |
| 7.   | [report.md](https://github.com/FedorSafonov/tracking-objects-on-a-conveyor-belt/blob/main/report.md) | Отчёт о проделанной работе |
| 8.   | [Renue_group_5.ipynb](https://github.com/FedorSafonov/tracking-objects-on-a-conveyor-belt/blob/main/Renue_group_5.ipynb) | Тетрадка с ходом исследования |
| 9.   | [Presentation_Renue.pdf](https://github.com/FedorSafonov/tracking-objects-on-a-conveyor-belt/blob/main/Presentation_Renue.pdf) | Презентация проекта |

## Итоги

* **Основные выводы:**  
В ходе проекта были протестированы 2 трекера: SORT (Simple Online and Realtime Tracking) и ByteTrack с разным размером изображений на выходе (imgsz) и разным количеством кадров. В результате трекер BoT-SORT показал более высокие значения MOTA, однако скорость работы ByteTrack была в 1,7-2,7 раза выше в зависимости от размера изображения. Также отмечено, что скорость и точность работы трекеров значительно зависит от среды, в которой выполняется обработка видео. В целом модель хорошо справляется с разными форматами и разным количеством кадров, показывая высокую метрику (0,909-0,918).
Для заявленной цели – создать модель потокового трекинга пластиковой тары на конвейере, которая выдает координаты центра обнаруженных объектов для каждого видеокадра со скоростью обработки потока не более 100 мс – больше подойдет предобученная модель YOLOv10 с трекером BoT-SORT.
 
* **Проект может быть развит в следующих направлениях:**
   * **Использование других моделей и трекеров:** Deep SORT, FairMOT, DEVA, CSRT.
   * **Обучение моделей на датасете большего размера:**  Обучение моделей на большем датасете может улучшить их качество и обобщающую способность.
   * **Изменить положение записывающей камеры:**
     - Переместить камеру дальше от места подачи мусора, чтобы исключить "влетание" мусора в кадр и дальнейшее его передвижение по конвейерной ленте.
     - Поднять камеру выше над транспортерной лентой. При том же угле обзора это расширит поле зрения камеры и позволит модели дольше сопровождать объекты, что, в свою очередь, даст выигрыш в качестве трекинга.  
   * **Использование Streamlit/FastAPI для более удобного трекинга и детекции объектов и анализа результатов**

## Cтатус: 
Завершён.

## Стэк:
Python, Ultralytics, Motmetrics, OpenCV, PyTorch, Numpy, SciPy, time, timedelta, PIL, OS, Glob

## Команда проекта
- [Юрий Кашин](https://github.com/yakashin)


